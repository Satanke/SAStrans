# SAS数据集翻译平台

这是一个基于Flask和Bootstrap构建的SAS数据集翻译web平台，支持RAW和SDTM两种翻译模式。

## 功能特性

### 核心功能
- **双模式支持**: RAW模式和SDTM模式
- **数据集读取**: 自动读取指定路径下的所有SAS数据集文件
- **数据预览**: 多选项卡展示数据集内容
- **SUPP数据合并**: SDTM模式下自动处理SUPPxx数据集合并
- **动态变量合并**: 可视化界面配置变量合并规则

### 界面特点
- 现代化响应式设计
- Bootstrap 5 + FontAwesome图标
- 直观的选项卡式数据展示
- 实时加载状态提示
- 友好的错误处理机制

## 安装和运行

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 启动应用
```bash
python app.py
```

### 3. 访问应用
在浏览器中打开: http://localhost:5000

## 使用说明

### RAW模式
1. 选择翻译模式为"RAW"
2. 输入SAS数据集文件夹路径
3. 点击"读取"按钮
4. 系统将直接读取所有SAS文件并以选项卡形式展示

### SDTM模式
1. 选择翻译模式为"SDTM"
2. 输入SAS数据集文件夹路径
3. 点击"读取"按钮
4. 系统自动处理SUPPxx数据集合并:
   - SUPPxx中的QNAM作为新变量名
   - QLABEL作为变量标签
   - QVAL作为变量值
   - 根据RDOMAIN匹配目标数据集
   - 按STUDYID和USUBJID进行合并

### 变量合并功能（SDTM模式）
1. 在数据预览下方点击"添加合并配置"
2. 在弹出窗口中：
   - 选择数据集
   - 选择目标变量（第一个选择的变量）
   - 继续选择源变量（要合并的其他变量）
3. 点击"完成配置"
4. 重复步骤1-3添加更多合并规则
5. 点击"确认合并"执行变量合并

## 技术架构

### 后端技术栈
- **Flask**: Web框架
- **pandas**: 数据处理
- **pyreadstat**: SAS文件读取
- **numpy**: 数值计算

### 前端技术栈
- **Bootstrap 5**: UI框架
- **JavaScript ES6**: 前端逻辑
- **FontAwesome**: 图标库
- **原生DOM API**: 数据操作

## 项目结构
```
pythonlearn/
├── app.py                 # Flask主应用
├── requirements.txt       # Python依赖
├── templates/
│   └── index.html        # 主页面模板
├── static/
│   ├── style.css         # 自定义样式
│   └── app.js           # 前端JavaScript
└── README_SAS_Platform.md # 使用说明
```

## 核心算法

### SUPP数据集处理算法
```python
def _process_sdtm_datasets(self):
    # 1. 识别SUPPxx数据集
    # 2. 根据RDOMAIN确定目标数据集
    # 3. 执行数据转置和合并
    # 4. 更新目标数据集
```

### 变量合并算法
```python
def merge_variables(self, merge_config):
    # 1. 按配置合并指定变量
    # 2. 将多个源变量值连接到目标变量
    # 3. 删除已合并的源变量
    # 4. 返回处理结果
```

## 注意事项

1. **文件路径**: 确保输入的路径包含.sas7bdat文件
2. **内存使用**: 大型数据集可能占用较多内存
3. **浏览器兼容**: 推荐使用现代浏览器（Chrome、Firefox、Edge）
4. **编码格式**: SAS文件编码应为系统支持的格式

## 故障排除

### 常见问题
1. **"路径不存在"**: 检查输入路径是否正确
2. **"读取文件失败"**: 确认SAS文件格式和权限
3. **页面加载慢**: 检查数据集大小和网络连接
4. **合并失败**: 确认变量名称和数据类型匹配

### 错误日志
应用运行时的错误信息会显示在浏览器页面顶部，同时后端控制台也会输出详细日志。

## 扩展功能

平台具有良好的扩展性，可以考虑添加：
- 数据导出功能
- 更多数据处理算法
- 用户认证系统
- 数据可视化图表
- 批量处理任务队列
